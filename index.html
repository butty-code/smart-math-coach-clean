<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irish Maths Learning Tool</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide icons as inline SVG components
        const BookOpen = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        );
        
        const Lightbulb = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/>
                <path d="M9 18h6"/><path d="M10 22h4"/>
            </svg>
        );
        
        const RotateCcw = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </svg>
        );
        
        const Check = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="20 6 9 17 4 12"/>
            </svg>
        );
        
        const X = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );
        
        const Shuffle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/>
                <polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/>
                <line x1="4" y1="4" x2="9" y2="9"/>
            </svg>
        );
        
        const Award = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>
            </svg>
        );
        
        const TrendingUp = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>
            </svg>
        );

        const MathFlashcards = () => {
          const [currentLevel, setCurrentLevel] = useState('junior');
          const [currentCategory, setCurrentCategory] = useState('all');
          const [currentCard, setCurrentCard] = useState(null);
          const [isFlipped, setIsFlipped] = useState(false);
          const [showHint, setShowHint] = useState(false);
          const [quizAnswer, setQuizAnswer] = useState('');
          const [quizResult, setQuizResult] = useState(null);
          const [score, setScore] = useState(0);
          const [attempted, setAttempted] = useState(0);
          const [sessionStats, setSessionStats] = useState({ correct: 0, total: 0 });
          const [showApiSetup, setShowApiSetup] = useState(false);
          const [apiKey, setApiKey] = useState('');
          const [showAiExplanation, setShowAiExplanation] = useState(false);
          const [aiExplanation, setAiExplanation] = useState('');
          const [aiLoading, setAiLoading] = useState(false);
          const [explanationLevel, setExplanationLevel] = useState('simple');

          const questionBank = {
            junior: {
              algebra: [
                {
                  generate: () => {
                    const a = Math.floor(Math.random() * 5) + 2;
                    const b = Math.floor(Math.random() * 10) + 5;
                    const result = Math.floor(Math.random() * 15) + 10;
                    const x = (result - b) / a;
                    return {
                      question: `Solve for x: ${a}x + ${b} = ${result}`,
                      hint: `Start by subtracting ${b} from both sides, then divide by ${a}`,
                      steps: [
                        `Step 1: Subtract ${b} from both sides`,
                        `${a}x + ${b} - ${b} = ${result} - ${b}`,
                        `${a}x = ${result - b}`,
                        `Step 2: Divide both sides by ${a}`,
                        `x = ${(result - b) / a}`
                      ],
                      answer: String(x),
                      visual: "equation"
                    };
                  }
                },
                {
                  generate: () => {
                    const a = Math.floor(Math.random() * 4) + 2;
                    const b = Math.floor(Math.random() * 8) + 2;
                    return {
                      question: `Expand: ${a}(x + ${b})`,
                      hint: `Multiply everything inside the brackets by ${a}`,
                      steps: [
                        `Step 1: Multiply ${a} by x`,
                        `${a} √ó x = ${a}x`,
                        `Step 2: Multiply ${a} by ${b}`,
                        `${a} √ó ${b} = ${a * b}`,
                        `Step 3: Combine the results`,
                        `Answer: ${a}x + ${a * b}`
                      ],
                      answer: `${a}x+${a * b}`,
                      visual: "distribution"
                    };
                  }
                }
              ],
              geometry: [
                {
                  generate: () => {
                    const base = Math.floor(Math.random() * 10) + 4;
                    const height = Math.floor(Math.random() * 8) + 3;
                    const area = (base * height) / 2;
                    return {
                      question: `Find the area of a triangle with base ${base}cm and height ${height}cm`,
                      hint: `Remember: Area of triangle = ¬Ω √ó base √ó height`,
                      steps: [
                        `Step 1: Write the formula`,
                        `Area = ¬Ω √ó base √ó height`,
                        `Step 2: Substitute the values`,
                        `Area = ¬Ω √ó ${base} √ó ${height}`,
                        `Step 3: Calculate`,
                        `Area = ¬Ω √ó ${base * height} = ${area} cm¬≤`
                      ],
                      answer: String(area),
                      visual: "triangle"
                    };
                  }
                },
                {
                  generate: () => {
                    const radius = Math.floor(Math.random() * 8) + 3;
                    const circ = (2 * 3.14 * radius).toFixed(2);
                    return {
                      question: `Calculate the circumference of a circle with radius ${radius}cm (use œÄ = 3.14)`,
                      hint: `Circumference = 2œÄr, where r is the radius`,
                      steps: [
                        `Step 1: Write the formula`,
                        `C = 2œÄr`,
                        `Step 2: Substitute values`,
                        `C = 2 √ó 3.14 √ó ${radius}`,
                        `Step 3: Calculate`,
                        `C = ${(2 * 3.14 * radius).toFixed(2)} cm`
                      ],
                      answer: circ,
                      visual: "circle"
                    };
                  }
                }
              ],
              trigonometry: [
                {
                  generate: () => {
                    const pairs = [[3,5], [5,13], [8,10], [6,10]];
                    const [opp, hyp] = pairs[Math.floor(Math.random() * pairs.length)];
                    const sin = (opp / hyp).toFixed(2);
                    return {
                      question: `In a right-angled triangle, if the opposite side is ${opp}cm and hypotenuse is ${hyp}cm, find sin Œ∏`,
                      hint: `sin Œ∏ = opposite √∑ hypotenuse`,
                      steps: [
                        `Step 1: Identify the sides`,
                        `Opposite = ${opp} cm, Hypotenuse = ${hyp} cm`,
                        `Step 2: Apply the formula`,
                        `sin Œ∏ = opposite √∑ hypotenuse`,
                        `Step 3: Calculate`,
                        `sin Œ∏ = ${opp} √∑ ${hyp} = ${sin}`
                      ],
                      answer: sin,
                      visual: "rightTriangle"
                    };
                  }
                }
              ]
            },
            leaving: {
              algebra: [
                {
                  generate: () => {
                    const roots = [[2,3], [1,4], [2,5], [3,4]];
                    const [r1, r2] = roots[Math.floor(Math.random() * roots.length)];
                    const b = -(r1 + r2);
                    const c = r1 * r2;
                    return {
                      question: `Solve the quadratic equation: x¬≤ ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0`,
                      hint: `Try factorising first`,
                      steps: [
                        `Step 1: Factorise the equation`,
                        `Find two numbers that multiply to ${c} and add to ${b}`,
                        `Numbers: ${r1} and ${r2}`,
                        `Step 2: Write as factors`,
                        `(x - ${r1})(x - ${r2}) = 0`,
                        `Step 3: Solve each factor`,
                        `x = ${r1} or x = ${r2}`
                      ],
                      answer: `${r1},${r2}`,
                      visual: "quadratic"
                    };
                  }
                }
              ],
              geometry: [
                {
                  generate: () => {
                    const radius = Math.floor(Math.random() * 5) + 3;
                    const height = Math.floor(Math.random() * 8) + 6;
                    const volume = (3.14 * radius * radius * height).toFixed(1);
                    return {
                      question: `Find the volume of a cylinder with radius ${radius}cm and height ${height}cm (œÄ = 3.14)`,
                      hint: `Volume = œÄr¬≤h`,
                      steps: [
                        `Step 1: Write the formula`,
                        `V = œÄr¬≤h`,
                        `Step 2: Substitute the values`,
                        `V = 3.14 √ó ${radius}¬≤ √ó ${height}`,
                        `Step 3: Calculate r¬≤`,
                        `V = 3.14 √ó ${radius * radius} √ó ${height}`,
                        `Step 4: Final calculation`,
                        `V = ${volume} cm¬≥`
                      ],
                      answer: volume,
                      visual: "cylinder"
                    };
                  }
                }
              ],
              trigonometry: [
                {
                  generate: () => {
                    const sinValues = [0.3, 0.4, 0.5, 0.6, 0.7, 0.8];
                    const sinTheta = sinValues[Math.floor(Math.random() * sinValues.length)];
                    const cosTheta = Math.sqrt(1 - sinTheta * sinTheta).toFixed(2);
                    return {
                      question: `If sin Œ∏ = ${sinTheta} and Œ∏ is acute, find cos Œ∏`,
                      hint: `Use the Pythagorean identity: sin¬≤Œ∏ + cos¬≤Œ∏ = 1`,
                      steps: [
                        `Step 1: Write the identity`,
                        `sin¬≤Œ∏ + cos¬≤Œ∏ = 1`,
                        `Step 2: Substitute sin Œ∏ = ${sinTheta}`,
                        `(${sinTheta})¬≤ + cos¬≤Œ∏ = 1`,
                        `${(sinTheta * sinTheta).toFixed(2)} + cos¬≤Œ∏ = 1`,
                        `Step 3: Solve for cos¬≤Œ∏`,
                        `cos¬≤Œ∏ = ${(1 - sinTheta * sinTheta).toFixed(2)}`,
                        `Step 4: Take the square root`,
                        `cos Œ∏ = ${cosTheta}`
                      ],
                      answer: cosTheta,
                      visual: "unitCircle"
                    };
                  }
                }
              ]
            }
          };

          const generateNewCard = () => {
            let categories = currentCategory === 'all' 
              ? Object.keys(questionBank[currentLevel])
              : [currentCategory];
            
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            const questions = questionBank[currentLevel][randomCategory];
            const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
            
            const newCard = {
              ...randomQuestion.generate(),
              category: randomCategory
            };
            
            setCurrentCard(newCard);
            setIsFlipped(false);
            setShowHint(false);
            setQuizResult(null);
            setQuizAnswer('');
            setShowAiExplanation(false);
            setAiExplanation('');
          };

          useEffect(() => {
            generateNewCard();
          }, [currentLevel, currentCategory]);

          const checkAnswer = () => {
            const userAnswer = quizAnswer.trim().toLowerCase().replace(/\s/g, '');
            const correctAnswer = currentCard.answer.toLowerCase().replace(/\s/g, '');
            
            const userAnswers = userAnswer.split(',').sort();
            const correctAnswers = correctAnswer.split(',').sort();
            
            const isCorrect = JSON.stringify(userAnswers) === JSON.stringify(correctAnswers) ||
                              Math.abs(parseFloat(userAnswer) - parseFloat(correctAnswer)) < 0.1;
            
            setQuizResult(isCorrect);
            setAttempted(prev => prev + 1);
            setSessionStats(prev => ({
              correct: prev.correct + (isCorrect ? 1 : 0),
              total: prev.total + 1
            }));
            if (isCorrect) setScore(prev => prev + 1);
          };

          const getAiExplanation = async () => {
            if (!apiKey) {
              alert('Please set up your Claude API key first! Click the "‚öôÔ∏è AI Setup" button.');
              return;
            }

            setAiLoading(true);
            setShowAiExplanation(true);

            try {
              const explanationPrompts = {
                simple: "Explain this like I'm 5 years old, using simple words and fun examples",
                detailed: "Explain this step-by-step with clear reasoning at each stage",
                visual: "Explain this using analogies, real-world examples, and visual thinking"
              };

              const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "x-api-key": apiKey,
                  "anthropic-version": "2023-06-01"
                },
                body: JSON.stringify({
                  model: "claude-sonnet-4-20250514",
                  max_tokens: 1024,
                  messages: [
                    {
                      role: "user",
                      content: `I'm a secondary school student in Ireland and I'm struggling with this math problem:

Question: ${currentCard.question}

The solution steps are:
${currentCard.steps.join('\n')}

${explanationPrompts[explanationLevel]}. Help me understand WHY each step works and what the logic is behind it. Make it relatable to everyday life if possible.`
                    }
                  ]
                })
              });

              if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
              }

              const data = await response.json();
              setAiExplanation(data.content[0].text);
            } catch (error) {
              setAiExplanation(`‚ùå Error: ${error.message}\n\nPlease check:\n1. Your API key is valid\n2. You have credits in your Claude account\n3. Your internet connection is working`);
            } finally {
              setAiLoading(false);
            }
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-orange-50 p-4">
              <div className="max-w-4xl mx-auto">
                <div className="text-center mb-6">
                  <h1 className="text-3xl font-bold text-green-700 mb-2">üé≤ Dynamic Irish Maths Tool</h1>
                  <p className="text-gray-600">Every question is randomly generated!</p>
                  <button
                    onClick={() => setShowApiSetup(!showApiSetup)}
                    className="mt-2 px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition text-sm font-medium"
                  >
                    ‚öôÔ∏è AI Tutor Setup {apiKey && '‚úì'}
                  </button>
                </div>

                {showApiSetup && (
                  <div className="bg-white rounded-lg shadow-xl p-6 mb-6 border-2 border-purple-300">
                    <h3 className="text-xl font-bold text-purple-700 mb-4">ü§ñ AI Tutor Setup</h3>
                    
                    <div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                      <p className="text-sm text-blue-900 font-medium mb-2">üí° What is this?</p>
                      <p className="text-sm text-blue-800">
                        The AI Tutor uses Claude AI to explain solutions in different ways when you're stuck! 
                        It's like having a personal maths teacher available 24/7.
                      </p>
                    </div>

                    <div className="space-y-4">
                      <div>
                        <h4 className="font-semibold mb-2">üìã How to get your API Key:</h4>
                        <ol className="text-sm space-y-2 ml-4 list-decimal text-gray-700">
                          <li>Go to <a href="https://console.anthropic.com/" target="_blank" rel="noopener noreferrer" className="text-blue-600 underline">console.anthropic.com</a></li>
                          <li>Sign up or log in</li>
                          <li>Click "Get API Keys"</li>
                          <li>Create a new key and copy it</li>
                          <li>Paste it below</li>
                        </ol>
                      </div>

                      <div className="bg-yellow-50 border-l-4 border-yellow-400 p-3">
                        <p className="text-sm text-yellow-900">
                          üí∞ <strong>Pricing:</strong> Claude offers $5 free credits! That's hundreds of explanations. 
                          After that, pay-as-you-go (~‚Ç¨0.003 per explanation).
                        </p>
                      </div>

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          Your Claude API Key:
                        </label>
                        <input
                          type="password"
                          value={apiKey}
                          onChange={(e) => setApiKey(e.target.value)}
                          placeholder="sk-ant-..."
                          className="w-full p-3 border-2 rounded-lg focus:border-purple-500 focus:outline-none"
                        />
                        <p className="text-xs text-gray-500 mt-1">
                          üîí Your API key is stored only in your browser
                        </p>
                      </div>

                      <div className="flex gap-3">
                        <button
                          onClick={() => {
                            if (apiKey) {
                              alert('‚úÖ API Key saved! You can now use the AI Tutor feature.');
                              setShowApiSetup(false);
                            } else {
                              alert('‚ö†Ô∏è Please enter an API key first');
                            }
                          }}
                          className="flex-1 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-medium"
                        >
                          Save Key
                        </button>
                        <button
                          onClick={() => setShowApiSetup(false)}
                          className="px-6 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition"
                        >
                          Close
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                <div className="bg-white rounded-lg shadow-md p-4 mb-6">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Level</label>
                      <select 
                        value={currentLevel}
                        onChange={(e) => setCurrentLevel(e.target.value)}
                        className="w-full p-2 border rounded-lg"
                      >
                        <option value="junior">Junior Cycle</option>
                        <option value="leaving">Leaving Certificate</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Topic</label>
                      <select 
                        value={currentCategory}
                        onChange={(e) => setCurrentCategory(e.target.value)}
                        className="w-full p-2 border rounded-lg"
                      >
                        <option value="all">üé≤ Random Mix</option>
                        <option value="algebra">Algebra</option>
                        <option value="geometry">Geometry</option>
                        <option value="trigonometry">Trigonometry</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">New Question</label>
                      <button
                        onClick={generateNewCard}
                        className="w-full p-2 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-lg font-medium hover:from-green-600 hover:to-blue-600 transition flex items-center justify-center gap-2"
                      >
                        <Shuffle />
                        Shuffle New
                      </button>
                    </div>
                  </div>
                </div>

                {sessionStats.total > 0 && (
                  <div className="bg-gradient-to-r from-orange-100 to-pink-100 border-l-4 border-orange-500 p-4 mb-6 rounded">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-2">
                        <Award />
                        <span className="font-medium">Session Score: {sessionStats.correct}/{sessionStats.total}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <TrendingUp />
                        <span className="text-lg font-bold text-green-600">
                          {Math.round((sessionStats.correct / sessionStats.total) * 100)}%
                        </span>
                      </div>
                    </div>
                  </div>
                )}

                {currentCard && (
                  <div className="bg-white rounded-xl shadow-xl p-6 mb-6">
                    <div className="flex justify-between items-center mb-4">
                      <span className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
                        {currentCard.category.charAt(0).toUpperCase() + currentCard.category.slice(1)}
                      </span>
                      <button
                        onClick={() => setIsFlipped(!isFlipped)}
                        className="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition"
                      >
                        <RotateCcw />
                        {isFlipped ? 'Show Question' : 'Show Solution'}
                      </button>
                    </div>

                    {!isFlipped ? (
                      <div className="min-h-64">
                        <div className="flex items-start gap-2 mb-4">
                          <BookOpen />
                          <h2 className="text-xl font-semibold text-gray-800">{currentCard.question}</h2>
                        </div>

                        {!quizResult && (
                          <div className="mt-6">
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                              Your Answer:
                            </label>
                            <input
                              type="text"
                              value={quizAnswer}
                              onChange={(e) => setQuizAnswer(e.target.value)}
                              placeholder="Enter your answer..."
                              className="w-full p-3 border-2 rounded-lg mb-3 focus:border-blue-500 focus:outline-none"
                              onKeyPress={(e) => e.key === 'Enter' && checkAnswer()}
                            />
                            <button
                              onClick={checkAnswer}
                              className="w-full py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition font-medium"
                            >
                              Check Answer
                            </button>
                          </div>
                        )}

                        {quizResult !== null && (
                          <div className={`mt-4 p-4 rounded-lg flex items-center gap-2 ${
                            quizResult 
                              ? 'bg-green-100 text-green-800' 
                              : 'bg-red-100 text-red-800'
                          }`}>
                            {quizResult ? <Check /> : <X />}
                            <div className="flex-1">
                              <span className="font-medium block">
                                {quizResult 
                                  ? 'üéâ Correct! Well done!' 
                                  : `‚ùå Not quite. The answer is: ${currentCard.answer}`}
                              </span>
                            </div>
                            <button
                              onClick={generateNewCard}
                              className="px-4 py-2 bg-white rounded-lg hover:bg-gray-50 transition font-medium"
                            >
                              Next Question ‚Üí
                            </button>
                          </div>
                        )}

                        <button
                          onClick={() => setShowHint(!showHint)}
                          className="mt-4 flex items-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-800 rounded-lg hover:bg-yellow-200 transition"
                        >
                          <Lightbulb />
                          {showHint ? 'Hide Hint' : 'Need a Hint?'}
                        </button>

                        {showHint && (
                          <div className="mt-3 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                            <p className="text-sm text-gray-700">üí° {currentCard.hint}</p>
                          </div>
                        )}

                        <div className="mt-6 pt-4 border-t-2 border-gray-200">
                          <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4">
                            <div className="flex items-center justify-between mb-3">
                              <div>
                                <h4 className="font-semibold text-purple-900">ü§ñ Still Confused?
